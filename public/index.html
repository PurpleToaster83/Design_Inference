<!doctype html>
<html ng-app="experimentApp">

<head>
  <title>Boxes and Keys</title>
  <link rel="icon" type="image/x-icon" href="images/favicon.ico">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:100,100i,300,300i,400,400i,700,700i,900,900i">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="styling.css" <!-- link to css styling file-->

  <!-- AngularJS -->
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.0/angular.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.0/angular-sanitize.js"></script>
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <!-- Initialize Firebase -->
  <script src="https://dkgbelief.firebaseapp.com/__/firebase/init.js"></script>
  <!-- Experiment App -->
  <script src="lib/preloader.js"></script>
  <script src="app.js"></script>
</head>

<body ng-controller="ExperimentController" ng-init="set_stimuli()">
  <div class="main w3-row">

    <!-- Left Side -->
    <div class="w3-col m5">

      <!-- Instructions -->
      <div ng-show="section == 'instructions' && instruction_has_text() && !instruction_has_image()" class="full-row"
        ng-bind-html="instructions[inst_id].text" ng-cloak>
      </div>

      <!-- Exam Questions-->
      <ul class="no-bullets-full-row" ng-show="is_exam()" ng-repeat="opt in instructions[inst_id].options" ng-cloak>
        <li><input type="radio" name="exam" ng-model="exam_response" ng-click="validate_exam(opt)" ng-disabled="is_feedback()" value="{{opt}}">
          <span class="checkboxtext" ng-bind-html="opt"></span>
        </li>
      </ul>
      <ul class="no-bullets-full-row" ng-show="is_feedback()" ng-repeat="opt in instructions[inst_id].options" ng-cloak>
        <li><input type="radio" name="exam" ng-model="last_exam_response" ng-disabled="true" value="{{opt}}">
          <span class="checkboxtext" ng-bind-html="opt"></span>
        </li>
      </ul>

      <!-- Exam Feedback-->
      <p ng-show="is_feedback()" class="feedback-full-row" ng-cloak>
        <strong ng-show="last_exam_correct == true" style="color:green">Correct. </strong>
        <strong ng-show="last_exam_correct == false" style="color:red">Incorrect. </strong>
        The answer is: <strong ng-bind-html="instructions[inst_id].options[instructions[inst_id].answer]"></strong>
      </p>
      <p ng-show="is_exam()" class="feedback-full-row"><br></p>

      <!-- Exam Endscreen -->
      <div ng-show="is_exam_end()" class="full-row" ng-cloak>
        <span ng-show="exam_score == exam_results.length">
          Great job, you answered <strong style="color:green">{{exam_score}}/{{exam_results.length}}</strong> questions correctly!<br>
          <br>
          Press <strong>Next</strong> to continue.
        </span>
        <span ng-show="exam_score < exam_results.length">
          You answered <strong style="color:red">{{exam_score}}/{{exam_results.length}}</strong> questions correctly.<br>
          <br>
          Press <strong>Next</strong> to retake the quiz, and try to answer all questions correctly.
        </span>
        <br><br>
      </div>

      <!-- Instruction Image -->
      <img ng-show="section == 'instructions' && instruction_has_image()" ng-src="{{instructions[inst_id].image}}"
        class="stimulus" id="instruction-img" ng-cloak>
      <p class="section_title" ng-show="section == 'instructions' && instruction_has_image()">Tutorial</p>

      <div class="section_title" style="float: left;" ng-show="section == 'stimuli' && part_id >= 0" ng-cloak>
        Round {{stim_id+1}}/{{stimuli_set.length}} </div>
      <div class="section_title" style="float: left;" ng-show="section == 'stimuli' && part_id < 0" ng-cloak>
        Round {{stim_id}}/{{stimuli_set.length}} </div>

      <!-- Stimuli -->
      <div>
        <img ng-show="section == 'stimuli' && part_id >= 0" ng-src="{{cur_stim_image()}}"
          class="stimulus" id="stimulus-img" ng-cloak> 
        <img ng-show="section == 'stimuli' && part_id == -1" ng-src="{{stimuli_set[stim_id-1].images.slice(-1)[0]}}"
          class="stimulus" id="stimulus-img-final" ng-cloak>
      </div>

      <!-- Endscreen -->
      <p ng-show="section == 'endscreen'" class="full-row" ng-cloak>
        You're all done! You scored <strong>{{total_reward}}</strong> points in total, equal to <strong>${{total_payment}}</strong> bonus payment.
        <br><br>
        Thank you for your time :)
        <br><br>
        Your completion code is: <strong>{{user_id}}</strong>
        <br><br>
        Please paste this code into the survey that you came from.
      </p>

      <!-- Controls -->
      <div class="controls" ng-cloak>
        <button class="button" ng-click="replay_all()"
          ng-show="section == 'stimuli' && part_id >= 0" ng-disabled="part_id <= 0">
          Replay All ⟲
        </button>
        <button class="button" ng-click="reload_gif()"
          ng-show="section == 'stimuli' && part_id >= 0" ng-disabled="part_id <= 0 || replaying">
          Replay ↶
        </button>
        <button class="button" ng-click="reload_gif()"
          ng-show="section == 'instructions' && instruction_has_image()">
          Replay ↶
        </button>
        <button class="button" ng-click="advance()" ng-show="section == 'stimuli' && part_id <= 0"
          ng-disabled="(stimuli_set.length == 0)">
          Next&ensp;▶
        </button>
        <button class="button" ng-click="advance()" ng-hide="section == 'stimuli' && part_id <= 0"
          ng-disabled="section == 'endscreen' ||
            (stimuli_set.length == 0) ||
            (valid_goal == false && has_goal_question()) && !hide_questions() ||
            (valid_belief == false && has_belief_question()) && !hide_questions() ||
            (valid_exam == false && section == 'instructions' && is_exam()) ||
            (valid_comprehension == false && section == 'instructions' && instruction_has_question())">
          Next&ensp;▶
        </button>
      </div>

    </div>

    <!-- Right Side -->
    <div class="w3-col m6" ng-show="show_rhs" style="margin-left: 5%;">

      <!-- Captioned Instructions -->
      <div ng-show="section == 'instructions' && instruction_has_image()" class="captions"
        ng-bind-html="instructions[inst_id].text" ng-cloak>
      </div>
      
      <!-- Scenario Start -->
      <div ng-show="(section == 'stimuli' && part_id == 0)" class="captions" ng-cloak>
        <p>Please take a moment to look over this scenario.<br><br>
           Press <strong>Next</strong> to continue.
        </p>
      </div>

      <!-- Goal Question -->
      <div ng-show="!hide_questions() && has_goal_question()" id="question" class="captions" ng-cloak>
        <p><strong>What liquid is in the bottle?</strong></p>
        <ul class="no-bullets-horizontal">
          <li><input type="checkbox" ng-model="response.goals[0]" ng-change="validate_goal()"
              ng-disabled="disable_questions()" id="goal0">
            <label for="goal0">
              <img src="images/sparkles.png" class="checkboximage"> <span class='checkboxtext'>Potion</span>
            </label>
          </li>
          <li><input type="checkbox" ng-model="response.goals[1]" ng-change="validate_goal()"
              ng-disabled="disable_questions()" id="goal1">
            <label for="goal1">
              <img src="images/skull.png" class="checkboximage"> <span class='checkboxtext'>Poison</span>
            </label>
          </li>
          <!-- <br>
          <li><input type="checkbox" ng-model="response.dontKnow" ng-change="toggle_dontknow()"
              ng-disabled="disable_questions()">
            <i class='checkboxtext'>All Equally Likely</i>
          </li> -->
        </ul>
        <br>
      </div>

      <!-- Belief Question -->
      <div ng-show="!hide_questions() && has_belief_question()" id="question" class="captions" ng-cloak>
        <p><strong>Please rate the following statements about the agent's <span class="underline">current beliefs</span>:</strong></p>
        <ul class="no-bullets" ng-repeat="stmt in belief_statements track by $index">
            <span class="statement"><strong>Statement:</strong> <span ng-bind-html="style_statement(stmt)"></span></span>
            <div class="rating-scale">
              <!-- Definitely False -->
              <div class="rating-button" ng-repeat="n in [1, 2, 3, 4, 5, 6, 7]">
                <label for="belief_rating_{{$parent.$index}}_{{n}}" class="rating-number">{{n}}</label>
                <input type="radio" name="belief_rating_{{$parent.$index}}" id="belief_rating_{{$parent.$index}}_{{n}}"
                  ng-model="response.beliefs[$parent.$index]" ng-value="n" ng-change="validate_belief()"
                  ng-disabled="disable_questions()"/>
                <label for="belief_rating_{{$parent.$index}}_{{n}}" class="rating-text" ng-bind-html="rating_text[n-1]"></label>
                </div>
              <!-- Definitely True -->
            </div>
        </ul>
      </div>

      <!-- Replay Hint -->
      <div ng-show="!hide_questions() && (section == 'stimuli' && part_id > 0)" class="captions" ng-cloak>
        <p>You may <strong>replay</strong> this scenario at any time.</p>
      </div>

      <!-- Post-Stimulus Feedback -->
      <p ng-show="section == 'stimuli' && part_id < 0" class="feedback" ng-cloak>
        You have competed the map and all of the <img class="caption-image" src="images/potion.png"> have been investigated!
        <br><br>
        Press <strong>Next</strong> to continue to the next map.
      </p>

      <!-- Comprehension Questions -->
      <div ng-show="section == 'instructions' && instruction_has_question()" class="comprehension_question" ng-cloak>
        <p ng-bind-html="instructions[inst_id].question"></p>

        <ul class="no-bullets" ng-repeat="opt in instructions[inst_id].options">
          <li><input type="radio" name="comprehension" ng-model="comprehension_response" ng-click="validate_answer(opt)"
              value="{{opt}}"> <span class="checkboxtext" ng-bind-html="opt"></span>
          </li>
        </ul>
        <br>

        <div ng-hide="comprehension_response == ''" class="checkboxtext">
          <strong ng-show="valid_comprehension" style="color:green">Correct! Hit the Next button to continue.</strong>
          <strong ng-show="!valid_comprehension" style="color:red">Wrong answer, please try again!</strong>
        </div>
      </div>

      <div ng-show="section == 'instructions'" class="comprehension_question">
        <p ng-bind-html="instructions[inst_id].footnote"></p>
      </div>

    </div>

</body>

</html>
